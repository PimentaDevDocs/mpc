<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Minhocas Poker Club</title>
    <style>
        :root {
            --red: #dc3545;
            --green: #28a745;
            --blue: #007bff;
            --dark: #343a40;
            --gray: #6c757d;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            max-width: 850px;
            margin: 20px auto;
            background: #f0f2f5;
            padding: 15px;
        }

        .container {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        /* Timers */
        .timers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .timer-card {
            background: var(--dark);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            transition: background 0.3s;
            position: relative;
        }

        .timer-display {
            font-size: 2.5rem;
            font-family: monospace;
            color: #00ff00;
            margin: 10px 0;
        }

        /* Animação Alerta */
        @keyframes blinker {
            50% {
                background-color: var(--red);
            }
        }

        .timer-card.alarm-active {
            animation: blinker 0.6s linear infinite;
        }

        /* Interface */
        .input-row {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }

        button {
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: 0.2s;
            padding: 8px 12px;
        }

        .btn-add {
            background: var(--blue);
            color: white;
        }

        .btn-minus {
            background: var(--red);
            color: white;
            width: 35px;
            height: 35px;
        }

        .btn-plus {
            background: var(--blue);
            color: white;
            width: 35px;
            height: 35px;
        }

        .btn-remove {
            background: var(--red);
            color: white;
            min-width: 90px;
        }

        .btn-finish {
            background: var(--green);
            color: white;
            width: 100%;
            padding: 15px;
            font-size: 1.1em;
            margin-top: 20px;
        }

        .btn-clear {
            background: var(--gray);
            color: white;
            font-size: 0.8em;
            margin-top: 10px;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #eee;
            background: #fff;
            margin-bottom: 5px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }

        .qty {
            font-weight: bold;
            min-width: 30px;
            text-align: center;
            font-size: 1.2em;
        }

        .result-box {
            background: #e7f3ff;
            border-left: 6px solid var(--blue);
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
        }

        /* Histórico */
        .history-card {
            background: #fff;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .time-info {
            color: var(--blue);
            font-size: 0.9em;
            margin-bottom: 5px;
        }
    </style>
</head>

<body>

    <div class="timers-grid">
        <div class="timer-card" id="t10">
            <div class="timer-display">10:00</div>
            <button onclick="toggleTimer('t10', 600)" style="background:var(--green); color:white">Play/Pause</button>
            <button onclick="resetIndividual('t10', 600)" style="background:var(--gray); color:white">Reset</button>
        </div>
        <div class="timer-card" id="t7">
            <div class="timer-display">07:00</div>
            <button onclick="toggleTimer('t7', 420)" style="background:var(--green); color:white">Play/Pause</button>
            <button onclick="resetIndividual('t7', 420)" style="background:var(--gray); color:white">Reset</button>
        </div>
        <div class="timer-card" id="t2">
            <div class="timer-display">02:00</div>
            <button onclick="toggleTimer('t2', 120)" style="background:var(--green); color:white">Play/Pause</button>
            <button onclick="resetIndividual('t2', 120)" style="background:var(--gray); color:white">Reset</button>
        </div>
    </div>

    <div class="container">
        <div class="input-row">
            <input type="text" id="nomeInput" placeholder="Nome do jogador..."
                onkeypress="if(event.key==='Enter') add()">
            <button class="btn-add" onclick="add()">Adicionar Jogador</button>
        </div>
        <ul id="lista"></ul>
        <div id="calculoAtual" style="display:none">
            <hr>
            <h3>Distribuição em Tempo Real</h3>
            <p>Total de Entradas: <strong id="totalTxt">0</strong></p>
            <div id="dist"></div>
            <button class="btn-finish" onclick="finalizarPartida()">Finalizar Partida</button>
        </div>
    </div>

    <div class="container" id="historicoSection" style="display:none">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h3>Histórico de Partidas</h3>
            <button class="btn-clear" onclick="limparHistorico()">Limpar Tudo</button>
        </div>
        <div id="historicoLista"></div>
    </div>

    <script>
        let jogadores = JSON.parse(localStorage.getItem('poker_jogadores')) || [];
        let historico = JSON.parse(localStorage.getItem('poker_historico')) || [];
        let startTimePartida = localStorage.getItem('poker_startTime') ? new Date(localStorage.getItem('poker_startTime')) : null;
        let audioCtx = null;

        const timersData = {
            t10: { timeLeft: 600, interval: null, running: false, alarm: null },
            t7: { timeLeft: 420, interval: null, running: false, alarm: null },
            t2: { timeLeft: 120, interval: null, running: false, alarm: null }
        };

        // Inicialização
        window.onload = () => {
            render();
            renderHistorico();
        };

        function saveToLocal() {
            localStorage.setItem('poker_jogadores', JSON.stringify(jogadores));
            localStorage.setItem('poker_historico', JSON.stringify(historico));
            if (startTimePartida) localStorage.setItem('poker_startTime', startTimePartida.toISOString());
            else localStorage.removeItem('poker_startTime');
        }

        function playAlarm() {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(440, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); setTimeout(() => osc.stop(), 500);
        }

        function toggleTimer(id, initialSecs) {
            const t = timersData[id];
            const card = document.getElementById(id);
            if (!startTimePartida) {
                startTimePartida = new Date();
                saveToLocal();
            }
            if (t.running) {
                clearInterval(t.interval);
                t.running = false;
            } else {
                if (t.timeLeft <= 0) return;
                t.running = true;
                t.interval = setInterval(() => {
                    if (t.timeLeft > 0) {
                        t.timeLeft--;
                        updateTimerDisplay(id);
                    } else {
                        clearInterval(t.interval);
                        t.running = false;
                        card.classList.add('alarm-active');
                        t.alarm = setInterval(playAlarm, 1000);
                    }
                }, 1000);
            }
        }

        function resetIndividual(id, secs) {
            const t = timersData[id];
            clearInterval(t.interval);
            clearInterval(t.alarm);
            document.getElementById(id).classList.remove('alarm-active');
            t.running = false;
            t.timeLeft = secs;
            updateTimerDisplay(id);
        }

        function updateTimerDisplay(id) {
            const t = timersData[id];
            let m = Math.floor(t.timeLeft / 60);
            let s = t.timeLeft % 60;
            document.querySelector(`#${id} .timer-display`).innerText =
                `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
        }

        function add() {
            const input = document.getElementById('nomeInput');
            if (input.value.trim()) {
                jogadores.push({ nome: input.value.trim(), qtd: 0 });
                input.value = '';
                render();
                saveToLocal();
            }
        }

        function change(index, delta) {
            jogadores[index].qtd = Math.max(0, jogadores[index].qtd + delta);
            render();
            saveToLocal();
        }

        function remove(index) {
            if (confirm("Remover este jogador?")) {
                jogadores.splice(index, 1);
                render();
                saveToLocal();
            }
        }

        function render() {
            const lista = document.getElementById('lista');
            const calcAtual = document.getElementById('calculoAtual');
            lista.innerHTML = '';
            let total = 0;
            jogadores.forEach((j, i) => {
                total += j.qtd;
                lista.innerHTML += `<li><span><strong>${j.nome}</strong></span>
                <div class="controls">
                    <button class="btn-minus" onclick="change(${i}, -1)">-</button>
                    <span class="qty">${j.qtd}</span>
                    <button class="btn-plus" onclick="change(${i}, 1)">+</button>
                    <button class="btn-remove" onclick="remove(${i})">Remover</button>
                </div></li>`;
            });
            document.getElementById('totalTxt').innerText = total;
            calcAtual.style.display = jogadores.length > 0 ? 'block' : 'none';
            if (total > 0) calcular(total);
        }

        function calcular(total) {
            let pos = [0]; let saldo = total;
            let inicial = Math.min(4, saldo); pos[0] = inicial; saldo -= inicial;
            while (saldo > 0) {
                let u = pos.length - 1;
                if (pos[u] >= (pos.length === 1 ? 0 : 3)) { pos.push(1); saldo--; if (saldo <= 0) break; }
                for (let i = 0; i < pos.length; i++) {
                    if (i === pos.length - 1 && pos[i] >= 3 && pos.length > 1) continue;
                    if (saldo > 0) { pos[i]++; saldo--; }
                }
            }
            const d = document.getElementById('dist');
            d.innerHTML = '';
            pos.forEach((v, i) => d.innerHTML += `<div class="result-box"><span>${i + 1}º Lugar</span><strong>${v} fichas</strong></div>`);
            return pos;
        }

        function finalizarPartida() {
            const total = jogadores.reduce((acc, curr) => acc + curr.qtd, 0);
            if (total === 0) return alert("Adicione entradas!");

            const endTime = new Date();
            const durationMs = startTimePartida ? (endTime - startTimePartida) : 0;
            const diffHrs = Math.floor(durationMs / 3600000);
            const diffMins = Math.floor((durationMs % 3600000) / 60000);
            const duracaoTexto = diffHrs > 0 ? `${diffHrs}h ${diffMins}min` : `${diffMins} min`;

            historico.unshift({
                inicio: startTimePartida ? startTimePartida.toLocaleTimeString() : '--:--',
                fim: endTime.toLocaleTimeString(),
                duracao: duracaoTexto,
                total: total,
                resultado: calcular(total)
            });

            jogadores.forEach(j => j.qtd = 0);
            startTimePartida = null;
            Object.keys(timersData).forEach(id => resetIndividual(id, id === 't10' ? 600 : (id === 't7' ? 420 : 120)));
            render();
            renderHistorico();
            saveToLocal();
        }

        function renderHistorico() {
            const section = document.getElementById('historicoSection');
            const listaH = document.getElementById('historicoLista');
            if (historico.length === 0) { section.style.display = 'none'; return; }
            section.style.display = 'block';
            listaH.innerHTML = '';
            historico.forEach((p, i) => {
                listaH.innerHTML += `
                <div class="history-card">
                    <div style="display:flex; justify-content:space-between; font-weight:bold;">
                        <span>Partida #${historico.length - i}</span>
                        <span style="color:var(--green)">Total: ${p.total}</span>
                    </div>
                    <div class="time-info">⏱ ${p.inicio} às ${p.fim} (${p.duracao})</div>
                    <div style="font-size: 0.85em; color: #666;">
                        ${p.resultado.map((v, idx) => `${idx + 1}º: ${v}`).join(' | ')}
                    </div>
                </div>`;
            });
        }

        function limparHistorico() {
            if (confirm("Deseja apagar TODO o histórico de partidas?")) {
                historico = [];
                saveToLocal();
                renderHistorico();
            }
        }
    </script>
</body>

</html>
